# coding=utf-8
# @Author   : zpchcbd HG team
# @Time     : 2021-08-30 20:27

from exploit.service.base import *


def do(ip, port):
    s = socket.socket()
    # Mongodb数据库未授权访问漏洞
    try:
        s.connect((str(ip), port))
        s.send(b"@RSYNCD: 31\n")
        s.send(b'\n')
        time.sleep(0.5)
        result = s.recv(1024)
        if result:
            for path_name in re.split('\n', result.decode()):
                if path_name and not path_name.startswith('@RSYNCD: '):
                    return {
                        'name': 'uauth',
                        'url': str(ip),
                        '组件': 'rsync'
                    }
    except Exception as e:
        s.close()
        return