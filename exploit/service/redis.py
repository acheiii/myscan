# coding=utf-8
# @Author   : zpchcbd HG team
# @Time     : 2021-08-27 18:35
from exploit.service.base import *


'''Redis未授权'''
try:
    s = socket.socket()
    s.connect((str(_ip), 6379))
    s.send(b"INFO\r\n")
    result = s.recv(1024)
    if b"redis_version" in result:
        self.ipunauthlist.append({
            'name': '未授权访问漏洞',
            'url': str(_ip) + ":6379",
            '组件': 'Redis'
        })
except:
    pass
finally:
    s.close()

'''Redis弱口令漏洞'''
try:
    s = socket.socket()
    s.connect((_ip, int(6379)))
    s.send(b"INFO\r\n")
    result = s.recv(1024)
    if b"Authentication" in result:
        for _pass in self.password_list:
            s = socket.socket()
            s.connect((_ip, int(6379)))
            s.send("AUTH %s\r\n" % _pass)
            result = s.recv(1024)
            if '+OK' in result:
                self.ipunauthlist.append({
                    'name': '弱口令漏洞',
                    'url': str(_ip) + ':6379|' + str(_pass),
                    '组件': 'Redis'
                })
except:
    pass
finally:
    s.close()