# coding=utf-8

# 4567

# CVE-2019-17571
# nmap中没有，得自己加banner
from async_timeout import timeout
import asyncio
# from exploit.service.base import *


async def checkDeserialization(addr):
    pass
    # try:
    #     with timeout(5):
    #         reader, writer = await asyncio.open_connection(addr.split(':')[0], int(addr.split(':')[1]))
    #         s = socket.socket()
    #         s.connect((addr.split(':')[0], int(addr.split(':')[1])))
    #         s.send(b"stats")
    #         result = s.recv(1024)
    #         if b"STAT version" in result:
    #             return {'name': 'deserialization', 'url': addr, 'software': 'log4j'}
    # except Exception:
    #     pass
    # finally:
    #     try:
    #         writer.close()
    #     except NameError:
    #         pass


# log4j 反序列化
async def log4jScan(addr, pbar):
    vulList = []
    a = await checkDeserialization(addr)
    if a is not None:
        vulList.append(a)
    pbar.update(1)
    return vulList
