# coding=utf-8

from Exploit.Service.service import *

# dubbo反序列化漏洞

def do(ip, port):
    try:
        s = socket.socket()
        s.connect((str(_ip), 873))
        s.send(b"@RSYNCD: 31\n")
        s.send(b'\n')
        time.sleep(0.5)
        result = s.recv(1024)
        if result:
            for path_name in re.split('\n', result.decode()):
                if path_name and not path_name.startswith('@RSYNCD: '):
                    self.ipunauthlist.append({
                        'name': '未授权访问',
                        'url': str(_ip),
                        '组件': 'rsync'
                    })
    except:
        pass
    finally:
        s.close()