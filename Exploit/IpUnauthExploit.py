# coding:utf-8

from exploit.BaseExploit import *

import http.client
import socket
import time
import pymongo
import requests
from threading import Thread
from concurrent.futures import ThreadPoolExecutor
requests.packages.urllib3.disable_warnings()

TIMEOUT = 3


class IpUnauth(Exploit):
    def __init__(self, domain, queue: asyncio.Queue):
        super().__init__()
        self.user_list = ['root', 'sa', 'system', 'Administrtor', 'ubuntu']
        self.password_list = ['root', 'sa', 'Aa@123456','admin', 'test', 'mysql', '123456', 'admin1234', 'admin12345', '000000', '987654321', '1234', '12345']
        self.domain = domain
        self.ipunauthlist = []
        self.queue = queue

    def write_file(self, web_lists, target, page):
        workbook = openpyxl.load_workbook(abs_path + str(target) + ".xlsx")
        worksheet = workbook.worksheets[page]
        index = 0
        while index < len(web_lists):
            web = list()
            web.append(web_lists[index]['name'])
            web.append(web_lists[index]['url'])
            web.append(web_lists[index]['组件'])
            worksheet.append(web)
            index += 1
        workbook.save(abs_path + str(target) + ".xlsx")
        workbook.close()

    def exploit(self, _ip):
        pass

    def main(self):
        pass
        # logging.info("IpUnauthScan Start")
        # p = ThreadPoolExecutor(10)
        # temp_ips = []
        # for aaa in self.:
        #     flag = 0
        #     if aaa['target'] == 'subdomain':
        #         if aaa['ips'] != '':
        #             for i in temp_ips:
        #                 if aaa['ips'] == i:
        #                     flag += 1
        #             if flag == 0:
        #                 temp_ips.append(aaa['ips'])
        #                 p.submit(self.exploit, aaa['ips'])
        #                 print("未授权扫描IP：", aaa['ips'])
        # p.shutdown()
        # self.write_file(self.ipunauthlist, self.domain, 9)

    def test02(self):
        pass
        # await self.queue.join()


if __name__ == '__main__':
    starttime = time.time()
    list_ = ['172.30.212.58']
    thread_list = []
    for _ in list_:
        xxx = IpUnauth('nbcc.cn', _)
        thread_list.append(Thread(target=xxx.main))
    for i in thread_list:
        i.start()
    for i in thread_list:
        i.join()

    print(time.time() - starttime)
